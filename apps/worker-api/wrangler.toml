name = "media-platform-api"
main = "worker/src/index.js"
compatibility_date = "2026-01-30"
account_id = "3b0e3054c77ce716f407376182c2813c"
preview_urls = false

[observability]
enabled = true

[observability.logs]
enabled = true

[[kv_namespaces]]
binding = "STAR_KV"
id = "d71a91a0b997488ea0cac314bfbe5d25"
preview_id = "d71a91a0b997488ea0cac314bfbe5d25"

[[r2_buckets]]
binding = "GALLERY_R2"
bucket_name = "woodcarving-photos"
preview_bucket_name = "woodcarving-photos"

[vars]
# R2（外部URLとしてNotionへ保存するため、公開ベースURLが必要）
R2_PUBLIC_BASE_URL = "https://pub-c80f2f91aa634266b2e7178229073f65.r2.dev"

# インデックスJSON（URLを指定する場合）
# PARTI/CIPANTS_INDEX_URL 等を未設定にすると、R2（GALLERY_R2）から *KEY のオブジェクトを読みます。
#PARTICIPANTS_INDEX_URL = "https://example.com/participants_index.json"
#SCHEDULE_INDEX_URL = "https://example.com/schedule_index.json"
#STUDENTS_INDEX_URL = "https://example.com/students_index.json"
#TAGS_INDEX_URL = "https://example.com/tags_index.json"

# R2から読む場合のキー（任意）
#PARTICIPANTS_INDEX_KEY = "participants_index.json"
#SCHEDULE_INDEX_KEY = "schedule_index.json"
#STUDENTS_INDEX_KEY = "students_index.json"
#TAGS_INDEX_KEY = "tags_index.json"

# Notion DB ID（必須）
NOTION_WORKS_DB_ID = "2ee57846aac2802c811bf6d9177ceb11"
NOTION_TAGS_DB_ID = "2ee57846aac28024a43cda89615f7f1c"
# （任意）生徒DB ID。未設定の場合は作品DBの Relation(作者) から推定します。
NOTION_STUDENTS_DB_ID = "2fc57846aac281209bb2e7438629499a"

# Notionプロパティ名オーバーライド（実DB差分）
NOTION_WORKS_READY_PROP = "整備済み"
NOTION_WORKS_VENUE_PROP = ""
NOTION_WORKS_AUTHOR_PROP = "作者"
# NOTION_STUDENTS_EMAIL_PROP = "メールアドレス"
# NOTION_STUDENTS_NOTIFY_OPT_IN_PROP = "作品通知希望" # 未指定時は全員通知

# 生徒向けアップロード通知メール（任意）
# UPLOAD_NOTIFY_ENABLED = "true"
# UPLOAD_NOTIFY_FROM_EMAIL = "noreply@example.com"
# UPLOAD_NOTIFY_FROM_NAME = "木彫り教室"
# UPLOAD_NOTIFY_REPLY_TO = "support@example.com"
# UPLOAD_NOTIFY_BCC = "owner@example.com"
# UPLOAD_NOTIFY_SUBJECT = "作品画像を登録しました"
# UPLOAD_NOTIFY_RESERVATION_APP_URL = "https://example.com/reservation"
# UPLOAD_NOTIFY_GALLERY_URL = "https://example.com/gallery.html"
# UPLOAD_NOTIFY_RESEND_MIN_INTERVAL_MS = "600" # 送信間隔（ms）。Resendの2req/sec制限対策
# UPLOAD_NOTIFY_RESEND_RATE_LIMIT_RETRIES = "2" # 429時の再試行回数
# UPLOAD_NOTIFY_RESEND_RATE_LIMIT_RETRY_MS = "1500" # 429時の最小待機時間（ms）

# 参加者/生徒/タグインデックスのR2キー（任意）
PARTICIPANTS_INDEX_KEY = "participants_index.json"
SCHEDULE_INDEX_KEY = "schedule_index.json"
STUDENTS_INDEX_KEY = "students_index.json"
TAGS_INDEX_KEY = "tags_index.json"
# participants_index push受信用のBearerは secret で設定:
#   npx wrangler secret put UPLOAD_UI_PARTICIPANTS_INDEX_PUSH_TOKEN
# schedule_index push受信用のBearerは secret で設定（任意。未設定時はparticipants用を流用）:
#   npx wrangler secret put UPLOAD_UI_SCHEDULE_INDEX_PUSH_TOKEN
# 管理API保護用のBearerは secret で設定:
#   npx wrangler secret put ADMIN_API_TOKEN
# 生徒向け通知メール送信用（Resend APIキー、任意）:
#   npx wrangler secret put UPLOAD_NOTIFY_RESEND_API_KEY

# GitHub Actions（ギャラリー更新トリガー用）
GITHUB_REPO = "kwsksj/media-platform"
GITHUB_WORKFLOW_FILE = "gallery-export.yml"
GITHUB_TAGS_WORKFLOW_FILE = ""
GITHUB_REF = "main"
